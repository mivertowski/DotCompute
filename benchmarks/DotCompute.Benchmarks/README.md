# DotCompute Performance Benchmarks\n\nComprehensive performance benchmarking suite for DotCompute framework, designed to validate performance claims and provide detailed analysis of compute acceleration capabilities.\n\n## üìä Benchmark Suites\n\n### 1. Core Performance Benchmarks\n**Validates the claimed 8-23x speedup through SIMD vectorization**\n\n- **Vector Operations**: Addition, multiplication, dot product\n- **Matrix Operations**: Transpose, tiled operations\n- **Parallel Reductions**: Sum operations with various strategies\n- **SIMD Comparisons**: Scalar vs AVX2 vs AVX512 performance\n\n**Key Metrics:**\n- Speedup ratios (baseline: scalar implementation)\n- Throughput (GFLOPS)\n- Performance scaling across data sizes\n\n### 2. CPU vs GPU Benchmarks\n**Comprehensive comparison between CPU and GPU execution strategies**\n\n- **Vector Addition**: Scalar, AVX2, AVX512, CUDA implementations\n- **Matrix Multiplication**: Naive, tiled, GPU hierarchical approaches\n- **Reduction Operations**: Sequential, SIMD, parallel, GPU tree reduction\n- **Complex Workloads**: SAXPY operations with multiple backends\n\n**Key Metrics:**\n- CPU/GPU performance ratios\n- Optimal backend recommendations by data size\n- Memory transfer overhead analysis\n\n### 3. Memory Benchmarks\n**Validates the claimed 90% reduction in memory allocations**\n\n- **Allocation Patterns**: Standard arrays vs UnifiedBuffer vs pooled allocation\n- **Transfer Performance**: Host-to-host, host-to-device, P2P transfers\n- **Access Patterns**: Sequential, random, strided memory access\n- **Memory Pressure**: High-frequency allocation scenarios\n\n**Key Metrics:**\n- Memory efficiency ratings\n- Bandwidth utilization (GB/s)\n- Allocation overhead reduction percentages\n\n### 4. Kernel Compilation Benchmarks\n**Measures kernel compilation and caching performance**\n\n- **Compilation Speed**: CPU vs CUDA compilation times\n- **Caching Efficiency**: Cache hit/miss performance\n- **Optimization Impact**: Different optimization levels\n- **Parallel Compilation**: Sequential vs parallel kernel compilation\n\n**Key Metrics:**\n- Compilation efficiency ratings\n- Estimated cache hit rates\n- Optimization overhead analysis\n\n### 5. Scalability Benchmarks\n**Tests performance scaling across varying data sizes and system loads**\n\n- **Data Size Scaling**: 1K to 100M elements\n- **Thread Scaling**: 1 to 16 threads\n- **System Load Tests**: Light, heavy, and mixed workloads\n- **Memory Bandwidth**: NUMA-aware processing patterns\n\n**Key Metrics:**\n- Scalability efficiency ratings\n- Thread utilization efficiency\n- Data throughput (GB/s)\n\n## üöÄ Quick Start\n\n### Prerequisites\n\n- **.NET 9.0 SDK** or later\n- **Visual Studio 2022 17.8+** or VS Code\n- **CUDA Toolkit 12.0+** (optional, for GPU benchmarks)\n- **NVIDIA GPU** with Compute Capability 5.0+ (optional)\n\n### Building the Benchmarks\n\n```bash\n# Clone and navigate to the project\ncd /path/to/DotCompute\n\n# Build the benchmark project\ndotnet build benchmarks/DotCompute.Benchmarks/DotCompute.Benchmarks.csproj --configuration Release\n\n# Or build the entire solution\ndotnet build DotCompute.sln --configuration Release\n```\n\n### Running Benchmarks\n\n#### Interactive Mode\n```bash\ncd benchmarks/DotCompute.Benchmarks\ndotnet run --configuration Release\n```\n\n#### Command Line Mode\n```bash\n# Run specific benchmark suite\ndotnet run --configuration Release -- core\ndotnet run --configuration Release -- cpu-vs-gpu\ndotnet run --configuration Release -- memory\ndotnet run --configuration Release -- compilation\ndotnet run --configuration Release -- scalability\n\n# Run all benchmarks\ndotnet run --configuration Release -- all\n\n# Quick validation\ndotnet run --configuration Release -- quick\n\n# Production validation (extended)\ndotnet run --configuration Release -- production\n```\n\n## üìà Advanced Usage\n\n### Filtering Benchmarks\n\n```bash\n# Filter by method name pattern\ndotnet run --configuration Release -- core --filter VectorAdd*\ndotnet run --configuration Release -- memory --filter *Allocation*\n\n# Filter by categories\ndotnet run --configuration Release -- cpu-vs-gpu --categories VectorAdd,MatrixMul\ndotnet run --configuration Release -- memory --categories Allocation,Transfer\n```\n\n### Export Options\n\n```bash\n# Multiple export formats\ndotnet run --configuration Release -- all --exporters html,csv,json,md\n\n# HTML report only\ndotnet run --configuration Release -- core --exporters html\n```\n\n### Performance Profiling\n\n```bash\n# Enable memory diagnostics\ndotnet run --configuration Release -- memory --memory-diagnoser\n\n# Enable hardware counters (Windows only)\ndotnet run --configuration Release -- core --hardware-counters\n\n# Enable ETW profiler (Windows only)\ndotnet run --configuration Release -- scalability --profiler ETW\n```\n\n### Job Configuration\n\n```bash\n# Quick dry run\ndotnet run --configuration Release -- core --job dry\n\n# Short run (reduced iterations)\ndotnet run --configuration Release -- all --job short\n\n# Extended validation\ndotnet run --configuration Release -- production --job long\n```\n\n### Statistical Analysis\n\n```bash\n# Enable baseline comparison\ndotnet run --configuration Release -- core --baseline-comparison\n\n# Configure outlier handling\ndotnet run --configuration Release -- memory --outliers RemoveUpper\n\n# Statistical significance testing\ndotnet run --configuration Release -- all --statistical-test Welch\n```\n\n## üìã Benchmark Results\n\n### Understanding Output\n\nBenchmark results include:\n\n1. **Execution Times**: Mean, median, min, max, P95, P99\n2. **Memory Statistics**: Allocations per operation, GC pressure\n3. **Custom Metrics**: Speedup ratios, throughput, efficiency ratings\n4. **Performance Analysis**: Automated validation of performance claims\n\n### Example Output Structure\n\n```\n// Core Performance Results\n|                Method |     DataSize |      Mean |    StdDev |    Median |   Speedup | Throughput (GFLOPS) |\n|---------------------- |------------- |----------:|----------:|----------:|----------:|---------------------:|\n|       VectorAdd_Scalar|    1,000,000 |  1.234 ms |  0.045 ms |  1.220 ms |     1.00x |                 2.43 |\n|    VectorAdd_SIMD_AVX2|    1,000,000 |  0.089 ms |  0.003 ms |  0.088 ms |    13.87x |                33.71 |\n|  VectorAdd_SIMD_AVX512|    1,000,000 |  0.053 ms |  0.002 ms |  0.052 ms |    23.28x |                56.60 |\n```\n\n### Report Locations\n\nAfter execution, detailed reports are generated in:\n\n```\nbenchmarks/DotCompute.Benchmarks/BenchmarkDotNet.Artifacts/\n‚îú‚îÄ‚îÄ results/\n‚îÇ   ‚îú‚îÄ‚îÄ DotCompute.Benchmarks.CorePerformanceBenchmarks-report.html\n‚îÇ   ‚îú‚îÄ‚îÄ DotCompute.Benchmarks.CorePerformanceBenchmarks-report.csv\n‚îÇ   ‚îî‚îÄ‚îÄ DotCompute.Benchmarks.CorePerformanceBenchmarks-report.json\n‚îî‚îÄ‚îÄ logs/\n    ‚îî‚îÄ‚îÄ DotCompute.Benchmarks.CorePerformanceBenchmarks.log\n```\n\n## üéØ Performance Validation\n\n### Automated Claim Validation\n\nThe benchmark suite automatically validates DotCompute's performance claims:\n\n#### ‚úÖ 8-23x Speedup Validation\n- Compares scalar vs SIMD implementations\n- Reports achieved speedup ratios\n- Validates against 8x minimum threshold\n\n#### ‚úÖ 90% Memory Reduction Validation\n- Compares standard allocation vs pooled allocation\n- Measures allocation overhead reduction\n- Validates against 90% reduction threshold\n\n#### ‚úÖ Sub-10ms Startup Validation\n- Measures framework initialization time\n- Validates Native AOT startup performance\n\n### Performance Insights\n\nThe suite provides actionable recommendations:\n\n- **Backend Selection**: CPU vs GPU recommendations by workload size\n- **Threading Optimization**: Optimal thread count suggestions\n- **Memory Strategy**: Allocation pattern recommendations\n- **Scalability Guidance**: Data size scaling advice\n\n## üîß Customization\n\n### Adding Custom Benchmarks\n\n1. **Create Benchmark Class**:\n```csharp\n[MemoryDiagnoser]\npublic class CustomBenchmarks\n{\n    [Benchmark]\n    public void CustomOperation()\n    {\n        // Your benchmark code\n    }\n}\n```\n\n2. **Register in Program.cs**:\n```csharp\nprivate static BenchmarkDotNet.Reports.Summary[] RunCustomBenchmarks(IConfig config)\n{\n    return new[] { BenchmarkRunner.Run<CustomBenchmarks>(config) };\n}\n```\n\n### Custom Metrics\n\nAdd custom columns for specialized metrics:\n\n```csharp\npublic class CustomMetricColumn : BenchmarkDotNet.Columns.IColumn\n{\n    public string ColumnName => \"Custom Metric\";\n    \n    public string GetValue(Summary summary, BenchmarkCase benchmarkCase)\n    {\n        // Calculate and return custom metric\n        return \"Custom Value\";\n    }\n}\n```\n\n### Environment-Specific Configuration\n\n```csharp\n// Configure for CI/CD environments\nif (Environment.GetEnvironmentVariable(\"CI\") == \"true\")\n{\n    config = config.AddJob(Job.Dry); // Fast execution\n}\n\n// Configure for specific hardware\nif (HasNvidiaGpu())\n{\n    config = config.AddColumn(new GpuUtilizationColumn());\n}\n```\n\n## üõ†Ô∏è Troubleshooting\n\n### Common Issues\n\n#### CUDA Not Available\n```\n‚ö†Ô∏è  CUDA not available: CUDA driver not found\n```\n**Solution**: Install NVIDIA GPU drivers and CUDA Toolkit, or run CPU-only benchmarks.\n\n#### Memory Pressure\n```\n‚ö†Ô∏è  OutOfMemoryException during large dataset benchmarks\n```\n**Solution**: Reduce dataset sizes or enable server GC:\n```bash\ndotnet run --configuration Release -- scalability --gc-server\n```\n\n#### Permission Issues (Windows)\n```\n‚ö†Ô∏è  Hardware counters not available: Access denied\n```\n**Solution**: Run as Administrator or disable hardware counters.\n\n### Performance Issues\n\n#### Slow Execution\n- Use `--job short` for faster execution\n- Reduce data size parameters\n- Run specific benchmark categories only\n\n#### Inconsistent Results\n- Ensure system is not under load\n- Close unnecessary applications\n- Use `--job long` for more stable results\n\n## üìö References\n\n### Performance Claims Documentation\n- [DotCompute Performance Architecture](../../docs/performance-architecture.md)\n- [SIMD Optimization Guide](../../docs/simd-optimization.md)\n- [Memory Management Strategy](../../docs/memory-management.md)\n\n### BenchmarkDotNet Documentation\n- [BenchmarkDotNet Official Guide](https://benchmarkdotnet.org/)\n- [Configuration Options](https://benchmarkdotnet.org/articles/configs/configs.html)\n- [Custom Metrics](https://benchmarkdotnet.org/articles/features/custom-metrics.html)\n\n### Hardware Requirements\n- [CUDA Compute Capability](https://developer.nvidia.com/cuda-gpus)\n- [CPU SIMD Support Detection](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics)\n\n## ü§ù Contributing\n\nTo contribute new benchmarks or improvements:\n\n1. **Fork the repository**\n2. **Create feature branch**: `git checkout -b feature/new-benchmark`\n3. **Add benchmarks** following existing patterns\n4. **Update documentation** with new benchmark descriptions\n5. **Test thoroughly** across different hardware configurations\n6. **Submit pull request** with detailed description\n\n### Benchmark Quality Guidelines\n\n- **Reproducible**: Results should be consistent across runs\n- **Representative**: Test realistic workloads and data sizes\n- **Well-documented**: Clear descriptions and expected outcomes\n- **Cross-platform**: Consider different OS and hardware configurations\n- **Performance-focused**: Measure meaningful performance characteristics\n\n## üìÑ License\n\nThis benchmark suite is part of the DotCompute project and is licensed under the MIT License. See [LICENSE](../../LICENSE) for details.\n\n---\n\n**Note**: Performance results may vary based on hardware configuration, system load, and environmental factors. Benchmarks are designed to be representative but should be validated in your specific deployment environment.